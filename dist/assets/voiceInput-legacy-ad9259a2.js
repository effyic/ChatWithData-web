!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var n,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function u(e,o,a,i){var u=o&&o.prototype instanceof l?o:l,s=Object.create(u.prototype);return t(s,"_invoke",function(e,t,o){var a,i,u,l=0,s=o||[],f=!1,v={p:0,n:0,v:n,a:p,f:p.bind(n,4),d:function(e,t){return a=e,i=0,u=n,v.n=t,c}};function p(e,t){for(i=e,u=t,r=0;!f&&l&&!o&&r<s.length;r++){var o,a=s[r],p=v.p,d=a[2];e>3?(o=d===t)&&(u=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=n):a[0]<=p&&((o=e<2&&p<a[1])?(i=0,v.v=t,v.n=a[1]):p<d&&(o=e<3||a[0]>t||t>d)&&(a[4]=e,a[5]=t,v.n=d,i=0))}if(o||e>1)return c;throw f=!0,t}return function(o,s,d){if(l>1)throw TypeError("Generator is already running");for(f&&1===s&&p(s,d),i=s,u=d;(r=i<2?n:u)||!f;){a||(i?i<3?(i>1&&(v.n=-1),p(i,u)):v.n=u:v.v=u);try{if(l=2,a){if(i||(o="next"),r=a[o]){if(!(r=r.call(a,u)))throw TypeError("iterator result is not an object");if(!r.done)return r;u=r.value,i<2&&(i=0)}else 1===i&&(r=a.return)&&r.call(a),i<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=n}else if((r=(f=v.n<0)?u:e.call(t,v))!==c)break}catch(r){a=n,i=1,u=r}finally{l=1}}return{value:r,done:f}}}(e,a,i),!0),s}var c={};function l(){}function s(){}function f(){}r=Object.getPrototypeOf;var v=[][a]?r(r([][a]())):(t(r={},a,function(){return this}),r),p=f.prototype=l.prototype=Object.create(v);function d(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,i,"GeneratorFunction")),e.prototype=Object.create(p),e}return s.prototype=f,t(p,"constructor",f),t(f,"constructor",s),s.displayName="GeneratorFunction",t(f,i,"GeneratorFunction"),t(p),t(p,i,"Generator"),t(p,a,function(){return this}),t(p,"toString",function(){return"[object Generator]"}),(e=function(){return{w:u,m:d}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){function i(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(i("next",0),i("throw",1),i("return",2))},t(e,n,r,o)}function n(e,t,n,r,o,a,i){try{var u=e[a](i),c=u.value}catch(e){return void n(e)}u.done?t(c):Promise.resolve(c).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var i=e.apply(t,r);function u(e){n(i,o,a,u,c,"next",e)}function c(e){n(i,o,a,u,c,"throw",e)}u(void 0)})}}System.register(["./index-legacy-6cb1588e.js"],function(t,n){"use strict";var o,a,i,u,c,l,s,f;return{setters:[function(e){o=e._,a=e.r,i=e.P,u=e.o,c=e.c,l=e.a,s=e.Q,f=e.R}],execute:function(){var n=document.createElement("style");n.textContent=".voice-visualizer[data-v-edf16311]{width:100%;height:80px;background:transparent}canvas[data-v-edf16311]{width:100%;height:100%;background:transparent;display:block}\n",document.head.appendChild(n);var v={__name:"voiceInput",emits:["transcript"],setup:function(t,n){var o=n.expose,v=n.emit,p=a(null),d=a(null),h=null,y=null,w=null,g=null,m=null,b=null,x=[],_=[],k=0,O=!1,S=null,T=a(!0),j=function(){var e=p.value,t=d.value,n=window.devicePixelRatio||1,r=t.clientWidth,o=t.clientHeight;e.width=r*n,e.height=o*n,e.style.width=r+"px",e.style.height=o+"px";var a=e.getContext("2d");a.setTransform(1,0,0,1,0,0),a.scale(n,n);var i=Math.floor(r/6);_.length!==i&&(_=new Array(i).fill(0))},R=function(){(m=new ResizeObserver(function(){j()})).observe(d.value)},P=function(){var t=r(e().m(function t(n){var r,o;return e().w(function(e){for(;;)switch(e.n){case 0:return(r=new FormData).append("file",n,"recording.webm"),e.n=1,f.transcriptions(r);case 1:return o=e.v,console.log(o),e.a(2,o.asr_text||"")}},t)}));return function(e){return t.apply(this,arguments)}}(),A=function(){var t=r(e().m(function t(){return e().w(function(e){for(;;)switch(e.n){case 0:if(O){e.n=1;break}return e.a(2);case 1:O=!1,S=null,b.stop();case 2:return e.a(2)}},t)}));return function(){return t.apply(this,arguments)}}(),C=function(){if(g=requestAnimationFrame(C),y&&w){y.getByteTimeDomainData(w);var e=w.reduce(function(e,t){return e+Math.abs(t-128)},0)/w.length,t=k+.1*(e-k);k=t;var n=p.value,r=n.getContext("2d"),o=window.devicePixelRatio||1,a=n.width/o,i=n.height/o,u=_.length,c=t/128*i*.8;_.pop(),_.unshift(c),r.clearRect(0,0,n.width,n.height);for(var l=0;l<u;l++){var s=_[l],f=a-6*(l+1),v=(i-s)/2;r.fillStyle="black",r.fillRect(f,v,4,s)}t>5?(T.value&&!O&&T.value&&(x=[],b.start(),O=!0,console.log("开始录音")),S&&(clearTimeout(S),S=null)):T.value&&O&&!S&&(S=setTimeout(function(){A()},2e3))}},F=function(){var t=r(e().m(function t(){var n,o,a,i;return e().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.n=1,s();case 1:return j(),R(),t.p=2,t.n=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:n=t.v,h=new AudioContext,o=h.createMediaStreamSource(n),(y=h.createAnalyser()).fftSize=128,a=y.frequencyBinCount,w=new Uint8Array(a),o.connect(y),C(),(b=new MediaRecorder(n,{mimeType:"audio/webm"})).ondataavailable=function(e){e.data.size>0&&x.push(e.data)},b.onstop=r(e().m(function t(){var n,r,o;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(0!==x.length){e.n=1;break}return console.log("无录音数据"),e.a(2);case 1:return n=new Blob(x,{type:"audio/webm"}),e.p=2,e.n=3,P(n);case 3:r=e.v,v("transcript",r),e.n=5;break;case 4:e.p=4,o=e.v,console.error("转写失败:",o),v("transcript","");case 5:return e.a(2)}},t,null,[[2,4]])})),t.n=5;break;case 4:t.p=4,i=t.v,console.error("获取麦克风失败:",i),v("transcript","");case 5:return t.a(2)}},t,null,[[2,4]])}));return function(){return t.apply(this,arguments)}}(),G=function(){g&&cancelAnimationFrame(g),g=null,b&&"inactive"!==b.state&&b.stop(),h&&(h.close(),h=null),y=null,w=null,m&&(m.disconnect(),m=null);var e=p.value;e&&e.getContext("2d").clearRect(0,0,e.width,e.height)};return o({start:F,stop:G,setAutoSend:function(e){T.value=e,console.log("自动发送状态：",e)}}),i(function(){G()}),function(e,t){return u(),c("div",{class:"voice-visualizer",ref_key:"containerRef",ref:d},[l("canvas",{ref_key:"canvasRef",ref:p},null,512)],512)}}};t("default",o(v,[["__scopeId","data-v-edf16311"]]))}}})}();
